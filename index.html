<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Simulasi Trading Presisi</title>
    <style>
        /* --- RESET & LAYOUT UTAMA --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: none; user-select: none; -webkit-user-select: none; }
        
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: #000;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* --- WADAH UTAMA (THE CONTAINER) --- */
        /* Ini adalah kunci agar posisi tidak lari. */
        #app-viewport {
            position: relative;
            width: 100%; 
            height: 100%;
            height: 100dvh; /* Support layar modern */
            background: #000;
            overflow: hidden;
        }

        /* --- LAYAR GAMBAR --- */
        .screen {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: none;
            /* MEMAKSA GAMBAR MENGIKUTI WADAH 100% */
            background-size: 100% 100%; 
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }
        .screen.active { display: block; }

        /* --- AREA KLIK (KOTAK MERAH) --- */
        .click-area, .scroll-area {
            position: absolute; 
            z-index: 10; 
            cursor: pointer;
            /* Default: Transparan (Mode Main) */
            background: transparent; 
            border: none;
        }

        /* --- TAMPILAN MODE EDIT (AGAR BISA DISUSUN) --- */
        body.edit-mode .click-area {
            border: 3px solid #FFFF00; /* Kuning Terang */
            background: rgba(255, 255, 0, 0.3);
            box-shadow: 0 0 10px rgba(0,0,0,0.8);
        }
        body.edit-mode .scroll-area {
            border: 3px dashed #00FFFF; /* Cyan */
            background: rgba(0, 255, 255, 0.3);
        }
        body.edit-mode .scroll-area::after {
            content: "AREA SCROLL";
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #000; background: #00FFFF; font-size: 10px; font-weight: bold; padding: 2px 5px;
        }

        /* --- TAMPILAN MODE PETUNJUK (HINT SAAT MAIN) --- */
        body.show-hint .click-area {
            border: 3px solid #FF0000; /* Merah */
            background: rgba(255, 0, 0, 0.2);
            animation: blink 1s infinite alternate;
        }
        body.show-hint .scroll-area {
            border: 3px dashed #00FFFF;
            background: rgba(0, 255, 255, 0.1);
        }
        @keyframes blink { from { opacity: 0.5; } to { opacity: 1; } }

        /* --- UI KONTROL EDIT (HILANG SAAT MAIN) --- */
        #editor-ui {
            position: absolute; bottom: 0; left: 0; width: 100%;
            padding: 15px;
            background: rgba(0,0,0,0.9);
            border-top: 1px solid #444;
            display: flex; justify-content: center; gap: 10px;
            z-index: 9999;
            transition: transform 0.3s;
        }
        #editor-ui.pos-top { bottom: auto; top: 0; border-top: none; border-bottom: 1px solid #444; }
        
        body.play-mode #editor-ui { display: none !important; }

        button {
            padding: 12px 20px; border-radius: 8px; border: none;
            font-weight: bold; color: white; cursor: pointer; font-size: 14px;
        }
        .btn-move { background: #666; width: 50px; font-size: 18px; }
        .btn-lock { background: #28a745; box-shadow: 0 0 15px rgba(40, 167, 69, 0.5); }
        .btn-reset { background: #dc3545; }

        /* --- RESIZER (Hanya di Mode Edit) --- */
        .resizer {
            width: 40px; height: 40px;
            background: #007bff; border: 3px solid white; border-radius: 50%;
            position: absolute; right: -15px; bottom: -15px;
            z-index: 20; display: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        body.edit-mode .resizer { display: block; }

        /* --- TOMBOL GERIGI (TOGGLE HINT) --- */
        #gear-btn {
            position: absolute; top: 15px; left: 15px;
            width: 50px; height: 50px; z-index: 5000;
            opacity: 0.05; /* Hampir tidak terlihat */
            background: white; border-radius: 50%;
            cursor: pointer;
        }
        body.edit-mode #gear-btn { display: none; }
        #gear-btn:active { opacity: 0.3; }

        /* --- SCROLL WRAPPER STEP 8 --- */
        .scroll-wrapper {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow-y: scroll; -webkit-overflow-scrolling: touch; z-index: 5;
        }
        .scroll-wrapper::-webkit-scrollbar { display: none; }
        .scroll-wrapper img { width: 100%; display: block; }

        /* --- FINISH SCREEN --- */
        #finish-screen {
            background: #000; color: white; display: none;
            flex-direction: column; justify-content: center; align-items: center;
            width: 100%; height: 100%; z-index: 100;
        }
    </style>
</head>
<body class="edit-mode"> <!-- Mulai di Mode Edit -->

    <!-- Tombol Gerigi Hantu -->
    <div id="gear-btn" onclick="toggleHint()"></div>

    <!-- Kontrol Edit -->
    <div id="editor-ui">
        <button class="btn-move" onclick="moveUI()">‚Üï</button>
        <button class="btn-reset" onclick="resetPos()">‚ö†Ô∏è Reset</button>
        <button class="btn-lock" onclick="lockApp()">üîí Kunci & Mainkan</button>
    </div>

    <div id="app-viewport">
        
        <!-- STEP 1 -->
        <div class="screen active" id="screen-1" style="background-image: url('1.jpg');">
            <div id="box-1" class="click-area" style="top: 73%; left: 26%; width: 18%; height: 9%;" onclick="go(2)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 2 -->
        <div class="screen" id="screen-2" style="background-image: url('2.jpg');">
            <div id="box-2" class="click-area" style="top: 17%; left: 0%; width: 100%; height: 10%;" onclick="go(3)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 3 -->
        <div class="screen" id="screen-3" style="background-image: url('3.jpg');">
            <div id="box-3" class="click-area" style="top: 0%; left: 30%; width: 70%; height: 8%;" onclick="go(4)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 4 -->
        <div class="screen" id="screen-4" style="background-image: url('4.jpg');">
            <div id="box-4" class="click-area" style="top: 50%; left: 5%; width: 90%; height: 25%;" onclick="go(5)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 5 -->
        <div class="screen" id="screen-5" style="background-image: url('5.jpg');">
            <div id="box-5" class="click-area" style="top: 0%; left: 0%; width: 15%; height: 8%;" onclick="go(6)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 6 -->
        <div class="screen" id="screen-6" style="background-image: url('6.jpg');">
            <div id="box-6" class="click-area" style="top: 60%; left: 26%; width: 18%; height: 9%;" onclick="go(7)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 7 -->
        <div class="screen" id="screen-7" style="background-image: url('7.jpg');">
            <div id="box-7" class="click-area" style="bottom: 0%; left: 25%; width: 25%; height: 8%;" onclick="go(8)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 8 (SCROLL) -->
        <div class="screen" id="screen-8">
            <div class="scroll-wrapper"><img src="8.jpg" ondragstart="return false;"></div>
            <div id="box-8" class="scroll-area" style="top: 30%; left: 10%; width: 80%; height: 40%;"><div class="resizer"></div></div>
        </div>

        <!-- STEP 9 -->
        <div class="screen" id="screen-9" style="background-image: url('9.jpg');">
            <div id="box-9" class="click-area" style="top: 35%; right: 5%; width: 40%; height: 6%;" onclick="go(10)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 10 (2 TAHAP) -->
        <div class="screen" id="screen-10" style="background-image: url('10.jpg');">
            <div id="box-10a" class="click-area" style="top: 45%; left: 5%; width: 15%; height: 5%;" onclick="step10Part2()"><div class="resizer"></div></div>
            <div id="box-10b" class="click-area" style="display:none; top: 55%; left: 5%; width: 43%; height: 7%;" onclick="go(11)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 11 -->
        <div class="screen" id="screen-11" style="background-image: url('11.jpg');">
            <div id="box-11" class="click-area" style="top: 55%; right: 10%; width: 35%; height: 6%;" onclick="go(12)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 12 -->
        <div class="screen" id="screen-12" style="background-image: url('12.jpg');">
            <div id="box-12" class="click-area" style="bottom: 10%; left: 25%; width: 50%; height: 8%;" onclick="finish()"><div class="resizer"></div></div>
        </div>

        <!-- FINISH -->
        <div id="finish-screen">
            <h1 style="color: #28a745;">SUKSES!</h1>
            <button onclick="location.reload()" style="padding: 10px 30px; margin-top: 20px;">ULANGI</button>
        </div>

    </div>

    <script>
        const container = document.getElementById('app-viewport');
        const ui = document.getElementById('editor-ui');
        let isEdit = true;

        window.onload = function() {
            // Load posisi (Storage Baru: 'posisi_fix_universal')
            let saved = localStorage.getItem('posisi_fix_universal');
            if (saved) {
                try {
                    const pos = JSON.parse(saved);
                    for(let id in pos) {
                        const el = document.getElementById(id);
                        if(el) {
                            el.style.top = pos[id].t;
                            el.style.left = pos[id].l;
                            el.style.width = pos[id].w;
                            el.style.height = pos[id].h;
                        }
                    }
                } catch(e) {}
            }
            initEditLogic();
            initScrollLogic();
        };

        // --- SISTEM EDIT & KUNCI ---
        function lockApp() {
            if(confirm("Posisi sudah pas? Aplikasi akan dikunci permanen untuk dimainkan.")) {
                savePos();
                isEdit = false;
                document.body.classList.remove('edit-mode');
                document.body.classList.add('play-mode');
                
                // Fullscreen
                const de = document.documentElement;
                if(de.requestFullscreen) de.requestFullscreen().catch(()=>{});
                else if(de.webkitRequestFullscreen) de.webkitRequestFullscreen();

                // Reset state
                document.getElementById('box-10a').style.display = 'block';
                document.getElementById('box-10b').style.display = 'none';
            }
        }

        function moveUI() { ui.classList.toggle('pos-top'); }
        
        function toggleHint() { if(!isEdit) document.body.classList.toggle('show-hint'); }

        // --- NAVIGASI ---
        function go(step) {
            if(isEdit) return;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const t = document.getElementById('screen-'+step);
            if(t) t.classList.add('active');
        }

        function step10Part2() {
            if(isEdit) return;
            document.getElementById('box-10a').style.display = 'none';
            document.getElementById('box-10b').style.display = 'block';
        }

        function finish() {
            if(isEdit) return;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('finish-screen').style.display = 'flex';
        }

        // --- LOGIKA SCROLL ---
        function initScrollLogic() {
            const box = document.getElementById('box-8');
            let sy = 0;
            const hS = (y) => { sy = y; };
            const hE = (y) => { if(!isEdit && (sy - y > 40)) go(9); };

            box.addEventListener('touchstart', e => hS(e.touches[0].clientY), {passive:true});
            box.addEventListener('touchend', e => hE(e.changedTouches[0].clientY), {passive:true});
            box.addEventListener('mousedown', e => {
                hS(e.clientY);
                const up = mu => { hE(mu.clientY); document.removeEventListener('mouseup', up); };
                document.addEventListener('mouseup', up);
            });
        }

        // --- LOGIKA EDIT (DRAG & RESIZE) ---
        function initEditLogic() {
            const getXY = (e) => (e.touches && e.touches[0]) ? {x:e.touches[0].clientX, y:e.touches[0].clientY} : {x:e.clientX, y:e.clientY};
            
            const boxes = document.querySelectorAll('.click-area, .scroll-area');
            boxes.forEach(box => {
                const resizer = box.querySelector('.resizer');

                // RESIZE
                const startResize = (e) => {
                    if(!isEdit) return;
                    e.stopPropagation();
                    const start = getXY(e);
                    const sw = box.offsetWidth, sh = box.offsetHeight;
                    const cw = container.offsetWidth, ch = container.offsetHeight;
                    
                    const move = (ev) => {
                        const curr = getXY(ev);
                        box.style.width = ((sw + (curr.x - start.x))/cw*100) + '%';
                        box.style.height = ((sh + (curr.y - start.y))/ch*100) + '%';
                    };
                    const end = () => { unbind(move, end); };
                    bind(move, end);
                };

                // DRAG
                const startDrag = (e) => {
                    if(!isEdit || e.target.classList.contains('resizer')) return;
                    if(e.type === 'touchstart') e.preventDefault();
                    const start = getXY(e);
                    const rect = box.getBoundingClientRect();
                    // Hitung offset relatif terhadap container (viewport)
                    const sl = rect.left, st = rect.top; 

                    const move = (ev) => {
                        if(ev.type === 'touchmove') ev.preventDefault();
                        const curr = getXY(ev);
                        // Hitung posisi baru dalam persen
                        box.style.left = ((sl + (curr.x - start.x)) / container.offsetWidth * 100) + '%';
                        box.style.top = ((st + (curr.y - start.y)) / container.offsetHeight * 100) + '%';
                    };
                    const end = () => { unbind(move, end); };
                    bind(move, end);
                };

                if(resizer) {
                    resizer.addEventListener('mousedown', startResize);
                    resizer.addEventListener('touchstart', startResize, {passive:false});
                }
                box.addEventListener('mousedown', startDrag);
                box.addEventListener('touchstart', startDrag, {passive:false});
            });
        }

        function bind(mv, end) {
            document.addEventListener('mousemove', mv); document.addEventListener('mouseup', end);
            document.addEventListener('touchmove', mv, {passive:false}); document.addEventListener('touchend', end);
        }
        function unbind(mv, end) {
            document.removeEventListener('mousemove', mv); document.removeEventListener('mouseup', end);
            document.removeEventListener('touchmove', mv); document.removeEventListener('touchend', end);
        }

        function savePos() {
            const pos = {};
            document.querySelectorAll('.click-area, .scroll-area').forEach(b => {
                if(b.id) pos[b.id] = {t:b.style.top, l:b.style.left, w:b.style.width, h:b.style.height};
            });
            localStorage.setItem('posisi_fix_universal', JSON.stringify(pos));
        }

        function resetPos() {
            if(confirm("Reset semua posisi?")) {
                localStorage.removeItem('posisi_fix_universal');
                location.reload();
            }
        }
    </script>
</body>
</html>



<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor Simulasi DVTEAM</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #2c3e50;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: white;
            gap: 20px;
        }

        /* --- Panel Kontrol (Sebelah Kiri) --- */
        #control-panel {
            width: 300px;
            background: rgba(0,0,0,0.6);
            padding: 20px;
            border-radius: 10px;
        }

        button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            font-weight: bold;
            border: none;
            border-radius: 5px;
        }

        .btn-next { background: #3498db; color: white; }
        .btn-prev { background: #7f8c8d; color: white; }
        .btn-play { background: #27ae60; color: white; font-size: 1.1em; margin-top: 20px;}
        .btn-edit { background: #e67e22; color: white; display: none; }

        textarea {
            width: 100%;
            height: 150px;
            margin-top: 10px;
            font-size: 10px;
            background: #ecf0f1;
            color: #333;
        }

        /* --- Bingkai HP (Tengah) --- */
        #phone-frame {
            width: 360px; /* Lebar standar HP */
            height: 780px;
            background-color: #000;
            border-radius: 30px;
            border: 8px solid #111;
            position: relative;
            overflow: hidden; /* Penting agar gambar tidak keluar */
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        #screen-image {
            width: 100%;
            height: 100%;
            object-fit: fill; /* Memaksa gambar memenuhi layar */
            pointer-events: none; /* Agar gambar tidak ter-drag */
            user-select: none;
        }

        /* --- Area Klik (Hotspot) --- */
        #hotspot {
            position: absolute;
            background-color: rgba(255, 255, 0, 0.4); /* Kuning Transparan */
            border: 2px dashed red;
            cursor: move; /* Cursor pindah */
            z-index: 100;
            min-width: 30px;
            min-height: 30px;
            box-sizing: border-box;
        }

        /* Pegangan Resize (Pojok Kanan Bawah) */
        .resize-handle {
            width: 15px;
            height: 15px;
            background: red;
            position: absolute;
            right: 0;
            bottom: 0;
            cursor: nwse-resize; /* Cursor resize */
        }

        /* --- Mode PLAY (Simulasi Aktif) --- */
        body.play-mode #control-panel { display: none; } /* Sembunyikan panel edit */
        body.play-mode { align-items: center; } /* Tengahkan HP */
        
        body.play-mode #hotspot {
            background-color: rgba(255, 255, 0, 0.2); /* Lebih transparan */
            border: none; /* Hilangkan garis merah */
            cursor: pointer; /* Cursor jari */
            animation: pulse 1s infinite; /* Efek Kedip */
        }
        
        body.play-mode .resize-handle { display: none; } /* Hilangkan tombol resize */

        @keyframes pulse {
            0% { opacity: 0.2; transform: scale(1); box-shadow: 0 0 0 rgba(255,255,0,0); }
            50% { opacity: 0.6; transform: scale(1.02); box-shadow: 0 0 20px rgba(255,255,0,0.5); }
            100% { opacity: 0.2; transform: scale(1); box-shadow: 0 0 0 rgba(255,255,0,0); }
        }

        #step-indicator { margin-bottom: 10px; font-size: 14px; color: #bbb; }
    </style>
</head>
<body>

    <div id="control-panel">
        <h3>Mode Editor</h3>
        <div id="step-indicator">Gambar 1 dari 10</div>
        
        <p style="font-size: 12px; color:#ccc;">
            1. <b>Drag</b> tengah kotak untuk memindah.<br>
            2. <b>Drag</b> kotak merah kecil (pojok kanan bawah) untuk ubah ukuran.<br>
            3. Klik <b>Next</b> untuk simpan & lanjut.
        </p>

        <button class="btn-prev" onclick="prevStep()"> < Mundur</button>
        <button class="btn-next" onclick="nextStep()">Simpan & Lanjut ></button>
        
        <hr>
        <button class="btn-play" onclick="startSimulation()">â–¶ MULAI SIMULASI</button>
        
        <hr>
        <label style="font-size: 12px;">Salin kode ini jika sudah selesai edit:</label>
        <textarea id="config-output" readonly></textarea>
    </div>

    <div id="phone-frame">
        <img id="screen-image" src="" alt="Layar">
        
        <div id="hotspot">
            <div class="resize-handle"></div>
        </div>
    </div>

    <button class="btn-edit" id="reset-btn" style="position:fixed; bottom: 20px; width: 200px; z-index: 200;" onclick="stopSimulation()">Kembali ke Editor</button>

    <script>
        // --- DATA AWAL (Default Tengah) ---
        // Nanti nilai ini akan berubah saat Anda mengedit di layar
        let steps = [
            { img: "1.jpg", x: 100, y: 300, w: 100, h: 100 },
            { img: "2.jpg", x: 100, y: 300, w: 100, h: 100 },
            { img: "3.jpg", x: 100, y: 300, w: 100, h: 100 },
            { img: "4.jpg", x: 100, y: 300, w: 100, h: 100 },
            { img: "1.jpg", x: 100, y: 300, w: 100, h: 100 }, // Kembali ke home (Gbr 5 pakai Gbr 1)
            { img: "7.jpg", x: 100, y: 300, w: 100, h: 100 }, // Gbr 6 (Opalp) -> Gbr 7
            { img: "8.jpg", x: 100, y: 300, w: 100, h: 100 }, // Gbr 7 -> Gbr 8
            { img: "9.jpg", x: 100, y: 300, w: 100, h: 100 }, // Gbr 8 -> Gbr 9
            { img: "10.jpg", x: 100, y: 300, w: 100, h: 100 },// Gbr 9 -> Gbr 10
            { img: "10.jpg", x: 100, y: 300, w: 100, h: 100 } // Selesai
        ];

        // Jika gambar 5, 6 menggunakan gambar yang sudah ada, sesuaikan array di atas
        // Logika urutan gambar berdasarkan request Anda:
        // 1->2->3->4->(1)->(Opalp)->7->8->9->10
        // Karena request Anda "Gambar 5 klik home", saya asumsikan gambar 4 adalah sinyal, lalu gambar 5 adalah tombol home di gambar sinyal itu sendiri atau balik ke layar 1.
        // Di sini saya buat urutan index array murni: 0 s/d 9.
        
        // MAPPING FILE SESUAI PERMINTAAN
        const imageSequence = [
            "1.jpg", "2.jpg", "3.jpg", "4.jpg", 
            "1.jpg", // Gambar 5 (Klik Home) - Bisa pakai screenshot lain jika ada
            "7.jpg", // Gambar 6 (Klik Opalp - diasumsikan sudah di home) - Pakai 7 jika 6 tidak ada, atau upload 6.jpg
            "7.jpg", "8.jpg", "9.jpg", "10.jpg"
        ];
        
        // Override steps source based on sequence length
        // Reset steps array to match image sequence length
        if(steps.length !== imageSequence.length) {
            steps = imageSequence.map(src => ({ img: src, x: 50, y: 200, w: 150, h: 80 }));
        }

        let currentStep = 0;
        let isPlayMode = false;

        const imgEl = document.getElementById('screen-image');
        const hotspotEl = document.getElementById('hotspot');
        const phoneFrame = document.getElementById('phone-frame');
        const outputBox = document.getElementById('config-output');
        const stepIndicator = document.getElementById('step-indicator');

        // --- INIT ---
        function loadStep(index) {
            if (index < 0 || index >= steps.length) return;
            currentStep = index;
            
            const data = steps[index];
            imgEl.src = data.img;
            
            // Set posisi hotspot sesuai data tersimpan
            hotspotEl.style.left = data.x + 'px';
            hotspotEl.style.top = data.y + 'px';
            hotspotEl.style.width = data.w + 'px';
            hotspotEl.style.height = data.h + 'px';

            stepIndicator.innerText = `Langkah ${index + 1} (Gambar: ${data.img})`;
            updateOutput();
        }

        // --- NAVIGASI ---
        function nextStep() {
            saveCurrentPosition(); // Simpan posisi sebelum pindah
            if (currentStep < steps.length - 1) {
                loadStep(currentStep + 1);
            } else {
                alert("Ini langkah terakhir. Silakan klik 'Mulai Simulasi'.");
            }
        }

        function prevStep() {
            saveCurrentPosition();
            if (currentStep > 0) {
                loadStep(currentStep - 1);
            }
        }

        function saveCurrentPosition() {
            steps[currentStep].x = parseInt(hotspotEl.style.left);
            steps[currentStep].y = parseInt(hotspotEl.style.top);
            steps[currentStep].w = parseInt(hotspotEl.style.width);
            steps[currentStep].h = parseInt(hotspotEl.style.height);
            updateOutput();
        }

        function updateOutput() {
            // Hasilkan JSON agar user bisa simpan konfigurasi permanen
            outputBox.value = "let steps = " + JSON.stringify(steps, null, 2) + ";";
        }

        // --- SIMULASI LOGIC ---
        function startSimulation() {
            saveCurrentPosition(); // Pastikan tersimpan
            isPlayMode = true;
            document.body.classList.add('play-mode');
            document.getElementById('reset-btn').style.display = 'block';
            loadStep(0); // Mulai dari awal
        }

        function stopSimulation() {
            isPlayMode = false;
            document.body.classList.remove('play-mode');
            document.getElementById('reset-btn').style.display = 'none';
            loadStep(currentStep); // Kembali ke editor
        }

        // Klik Hotspot saat Mode Play
        hotspotEl.addEventListener('click', () => {
            if (!isPlayMode) return; // Abaikan jika mode edit
            
            if (currentStep < steps.length - 1) {
                // Efek visual klik
                hotspotEl.style.backgroundColor = "rgba(0, 255, 0, 0.5)";
                setTimeout(() => {
                    hotspotEl.style.backgroundColor = "";
                    loadStep(currentStep + 1);
                }, 100);
            } else {
                alert("Simulasi Selesai! Transaksi Berhasil.");
                startSimulation(); // Ulangi
            }
        });


        // --- DRAG & RESIZE LOGIC (Tanpa Library Tambahan) ---
        let isDragging = false;
        let isResizing = false;
        let startX, startY, startLeft, startTop, startW, startH;

        // Mouse Down pada Hotspot (Drag)
        hotspotEl.addEventListener('mousedown', (e) => {
            if (isPlayMode) return;
            if (e.target.classList.contains('resize-handle')) return; // Biarkan resize handle handle sendiri

            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            startLeft = hotspotEl.offsetLeft;
            startTop = hotspotEl.offsetTop;
            
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });

        // Mouse Down pada Resize Handle
        document.querySelector('.resize-handle').addEventListener('mousedown', (e) => {
            if (isPlayMode) return;
            e.stopPropagation(); // Jangan trigger drag
            isResizing = true;
            startX = e.clientX;
            startY = e.clientY;
            startW = hotspotEl.offsetWidth;
            startH = hotspotEl.offsetHeight;

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });

        function onMouseMove(e) {
            if (isPlayMode) return;

            if (isDragging) {
                let dx = e.clientX - startX;
                let dy = e.clientY - startY;
                hotspotEl.style.left = (startLeft + dx) + 'px';
                hotspotEl.style.top = (startTop + dy) + 'px';
            } else if (isResizing) {
                let dx = e.clientX - startX;
                let dy = e.clientY - startY;
                hotspotEl.style.width = (startW + dx) + 'px';
                hotspotEl.style.height = (startH + dy) + 'px';
            }
        }

        function onMouseUp() {
            isDragging = false;
            isResizing = false;
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
            saveCurrentPosition(); // Auto save saat lepas mouse
        }

        // Jalankan awal
        loadStep(0);

    </script>
</body>
</html>

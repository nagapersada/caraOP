<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Simulasi Trading Pro</title>
    <style>
        /* --- RESET & DASAR --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; -webkit-user-select: none; touch-action: none; }
        
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: #000;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* --- WADAH UTAMA (CONTAINER) --- */
        /* Kuncinya disini: Wadah ini memaksa konten memenuhi layar 100% */
        #app-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            /* Fix untuk Safari iOS Address Bar */
            height: -webkit-fill-available; 
            overflow: hidden;
            background: #000;
        }

        /* --- LAYAR GAMBAR --- */
        .screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: none;
            /* Memaksa gambar stretch memenuhi layar agar koordinat % selalu akurat */
            background-size: 100% 100%; 
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }
        .screen.active { display: block; }

        /* --- SCROLL WRAPPER (STEP 8) --- */
        .scroll-wrapper {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow-y: scroll; /* Scroll aktif */
            -webkit-overflow-scrolling: touch;
            z-index: 2;
            background: #000;
        }
        .scroll-wrapper img { width: 100%; display: block; height: auto; }
        /* Sembunyikan Scrollbar */
        .scroll-wrapper::-webkit-scrollbar { display: none; }

        /* --- AREA KLIK (KOTAK MERAH) --- */
        .click-area, .scroll-area {
            position: absolute; z-index: 10; cursor: pointer;
        }

        /* --- TAMPILAN MODE EDIT (JELAS) --- */
        body.edit-mode .click-area {
            border: 2px dashed #FFD700; /* Kuning Emas */
            background: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        body.edit-mode .scroll-area {
            border: 2px dashed #00BFFF; /* Biru Langit */
            background: rgba(0, 191, 255, 0.3);
        }
        /* Label Scroll saat Edit */
        body.edit-mode .scroll-area::after {
            content: "AREA SWIPE UP"; 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; font-weight: bold; font-size: 10px; 
            background: rgba(0,0,0,0.5); padding: 2px 5px; border-radius: 4px;
        }

        /* RESIZER (Hanya di Mode Edit) */
        .resizer {
            width: 30px; height: 30px;
            background: #007bff; border: 2px solid white; border-radius: 50%;
            position: absolute; right: -15px; bottom: -15px;
            z-index: 20; display: none;
        }
        body.edit-mode .resizer { display: block; }

        /* --- TAMPILAN MODE PLAY (BERSIH & PROFESIONAL) --- */
        body.play-mode .click-area, body.play-mode .scroll-area {
            border: none; background: transparent;
        }
        /* Efek sentuh halus di mode play */
        body.play-mode .click-area:active { background: rgba(255,255,255,0.1); }

        /* --- MODE PETUNJUK (HINT) --- */
        body.show-hint .click-area {
            border: 3px solid #ff3b30; /* Merah Apple */
            background: rgba(255, 59, 48, 0.2);
            animation: pulse 1s infinite alternate;
        }
        body.show-hint .scroll-area {
            border: 3px dashed #00BFFF;
            background: rgba(0, 191, 255, 0.2);
        }
        @keyframes pulse { from { opacity: 0.6; } to { opacity: 1; } }

        /* --- UI KONTROL EDIT (Melayang di Bawah) --- */
        #editor-ui {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(20, 20, 20, 0.95);
            padding: 10px 20px; border-radius: 50px;
            display: flex; gap: 10px; z-index: 9999;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            transition: opacity 0.3s;
        }
        
        body.play-mode #editor-ui { display: none; } /* Hilang saat main */

        button {
            background: #333; color: white; border: none; padding: 10px 15px;
            border-radius: 20px; font-weight: 600; font-size: 13px; cursor: pointer;
        }
        .btn-save { background: #28a745; color: white; }
        .btn-reset { background: #dc3545; color: white; }

        /* --- TOMBOL GERIGI (Hanya muncul di Play Mode) --- */
        #gear-btn {
            position: absolute; top: 20px; left: 20px;
            width: 40px; height: 40px; z-index: 5000;
            background: rgba(255,255,255,0.1); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 20px; cursor: pointer;
            backdrop-filter: blur(5px);
            opacity: 0.5; transition: opacity 0.3s;
            display: none; /* Hidden di edit mode */
        }
        body.play-mode #gear-btn { display: flex; }
        #gear-btn:active { opacity: 1; background: rgba(255,255,255,0.3); }

        /* --- TRIGGER RAHASIA (Pojok Kanan Atas - Kembali ke Edit) --- */
        #secret-trigger {
            position: absolute; top: 0; right: 0; width: 60px; height: 60px; z-index: 6000;
        }

        /* --- LAYAR FINISH --- */
        #finish-screen {
            background: #000; color: white; display: none;
            flex-direction: column; justify-content: center; align-items: center;
            width: 100%; height: 100%; z-index: 100;
        }
    </style>
</head>
<body class="edit-mode"> <!-- Default: Mode Edit agar bisa dipaskan dulu -->

    <!-- WADAH APLIKASI -->
    <div id="app-container">
        
        <!-- STEP 1 -->
        <div class="screen active" id="screen-1" style="background-image: url('1.jpg');">
            <div id="box-1" class="click-area" style="top: 73%; left: 26%; width: 18%; height: 9%;" onclick="next(2)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 2 -->
        <div class="screen" id="screen-2" style="background-image: url('2.jpg');">
            <div id="box-2" class="click-area" style="top: 17%; left: 0%; width: 100%; height: 10%;" onclick="next(3)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 3 -->
        <div class="screen" id="screen-3" style="background-image: url('3.jpg');">
            <div id="box-3" class="click-area" style="top: 0%; left: 30%; width: 70%; height: 8%;" onclick="next(4)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 4 -->
        <div class="screen" id="screen-4" style="background-image: url('4.jpg');">
            <div id="box-4" class="click-area" style="top: 50%; left: 5%; width: 90%; height: 25%;" onclick="next(5)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 5 -->
        <div class="screen" id="screen-5" style="background-image: url('5.jpg');">
            <div id="box-5" class="click-area" style="top: 0%; left: 0%; width: 15%; height: 8%;" onclick="next(6)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 6 -->
        <div class="screen" id="screen-6" style="background-image: url('6.jpg');">
            <div id="box-6" class="click-area" style="top: 60%; left: 26%; width: 18%; height: 9%;" onclick="next(7)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 7 -->
        <div class="screen" id="screen-7" style="background-image: url('7.jpg');">
            <div id="box-7" class="click-area" style="bottom: 0%; left: 25%; width: 25%; height: 8%;" onclick="next(8)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 8 (SCROLL) -->
        <div class="screen" id="screen-8">
            <div class="scroll-wrapper"><img src="8.jpg" alt="Scroll" ondragstart="return false;"></div>
            <!-- Kotak trigger untuk swipe -->
            <div id="box-8" class="scroll-area" style="top: 30%; left: 10%; width: 80%; height: 40%;"><div class="resizer"></div></div>
        </div>

        <!-- STEP 9 -->
        <div class="screen" id="screen-9" style="background-image: url('9.jpg');">
            <div id="box-9" class="click-area" style="top: 35%; right: 5%; width: 40%; height: 6%;" onclick="next(10)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 10 -->
        <div class="screen" id="screen-10" style="background-image: url('10.jpg');">
            <div id="box-10a" class="click-area" style="top: 45%; left: 5%; width: 15%; height: 5%;" onclick="step10Part2()"><div class="resizer"></div></div>
            <div id="box-10b" class="click-area" style="display:none; top: 55%; left: 5%; width: 43%; height: 7%;" onclick="next(11)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 11 -->
        <div class="screen" id="screen-11" style="background-image: url('11.jpg');">
            <div id="box-11" class="click-area" style="top: 55%; right: 10%; width: 35%; height: 6%;" onclick="next(12)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 12 -->
        <div class="screen" id="screen-12" style="background-image: url('12.jpg');">
            <div id="box-12" class="click-area" style="bottom: 10%; left: 25%; width: 50%; height: 8%;" onclick="finish()"><div class="resizer"></div></div>
        </div>

        <!-- FINISH -->
        <div id="finish-screen">
            <h1 style="color: #28a745;">SUKSES!</h1>
            <button class="btn-save" onclick="location.reload()">Ulangi</button>
        </div>

    </div>

    <!-- UI EDIT (HANYA MUNCUL DI AWAL) -->
    <div id="editor-ui">
        <button class="btn-reset" onclick="resetPositions()">‚ö†Ô∏è Reset</button>
        <button class="btn-save" onclick="lockAndPlay()">üîí Kunci & Mainkan</button>
    </div>

    <!-- TOMBOL GERIGI (HANYA DI PLAY MODE) -->
    <div id="gear-btn" onclick="toggleHint()">‚öôÔ∏è</div>

    <!-- RAHASIA: KLIK POJOK KANAN ATAS UNTUK BALIK EDIT -->
    <div id="secret-trigger" onclick="askToEdit()"></div>

    <script>
        const container = document.getElementById('app-container');
        let isEditMode = true;

        window.onload = function() {
            // Load posisi dari penyimpanan (menggunakan kunci unik baru biar fresh)
            const saved = localStorage.getItem('simulasi_pos_final_fix_v4');
            if (saved) {
                try {
                    const pos = JSON.parse(saved);
                    for(let id in pos) {
                        const el = document.getElementById(id);
                        if(el) {
                            el.style.top = pos[id].t;
                            el.style.left = pos[id].l;
                            el.style.width = pos[id].w;
                            el.style.height = pos[id].h;
                        }
                    }
                } catch(e) {}
            }
            
            initDragAndResize();
            initScrollLogic();
        };

        // --- FUNGSI MODE & KUNCI ---
        function lockAndPlay() {
            if (confirm("Sudah pas semua posisinya? Aplikasi akan dikunci ke Mode Layar Penuh.")) {
                savePositions();
                enterPlayMode();
            }
        }

        function enterPlayMode() {
            isEditMode = false;
            document.body.classList.remove('edit-mode');
            document.body.classList.add('play-mode');
            
            // Full Screen
            const el = document.documentElement;
            if(el.requestFullscreen) el.requestFullscreen().catch(()=>{});
            else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();

            // Reset Step 10 visibility
            document.getElementById('box-10a').style.display = 'block';
            document.getElementById('box-10b').style.display = 'none';
        }

        function askToEdit() {
            if(!isEditMode && confirm("Kembali ke Mode Edit untuk memperbaiki posisi?")) {
                isEditMode = true;
                document.body.classList.add('edit-mode');
                document.body.classList.remove('play-mode');
                document.body.classList.remove('show-hint');
                
                // Show Step 10 parts
                document.getElementById('box-10a').style.display = 'block';
                document.getElementById('box-10b').style.display = 'block';
            }
        }

        function toggleHint() {
            if(!isEditMode) document.body.classList.toggle('show-hint');
        }

        // --- NAVIGASI ---
        function next(step) {
            if(isEditMode) return; // Edit mode = no navigation
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const t = document.getElementById('screen-'+step);
            if(t) t.classList.add('active');
        }

        function step10Part2() {
            if(isEditMode) return;
            document.getElementById('box-10a').style.display = 'none';
            document.getElementById('box-10b').style.display = 'block';
        }

        function finish() {
            if(isEditMode) return;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('finish-screen').style.display = 'flex';
        }

        // --- SCROLL LOGIC (STEP 8) ---
        function initScrollLogic() {
            const box = document.getElementById('box-8');
            let sy = 0;
            
            const handleStart = (y) => { sy = y; };
            const handleEnd = (y) => {
                // Jika bukan edit mode DAN swipe ke atas > 40px
                if (!isEditMode && (sy - y > 40)) {
                    next(9);
                }
            };

            box.addEventListener('touchstart', e => handleStart(e.touches[0].clientY), {passive:true});
            box.addEventListener('touchend', e => handleEnd(e.changedTouches[0].clientY), {passive:true});
            box.addEventListener('mousedown', e => {
                handleStart(e.clientY);
                const up = mu => { handleEnd(mu.clientY); document.removeEventListener('mouseup', up); };
                document.addEventListener('mouseup', up);
            });
        }

        // --- DRAG & RESIZE (Hanya Aktif di Edit Mode) ---
        function initDragAndResize() {
            const boxes = document.querySelectorAll('.click-area, .scroll-area');
            
            // Helper convert event to coords
            const getXY = (e) => (e.touches && e.touches[0]) ? {x:e.touches[0].clientX, y:e.touches[0].clientY} : {x:e.clientX, y:e.clientY};

            boxes.forEach(box => {
                const resizer = box.querySelector('.resizer');

                // Resize Logic
                const startResize = (e) => {
                    if(!isEditMode) return;
                    e.stopPropagation();
                    const start = getXY(e);
                    const sw = box.offsetWidth, sh = box.offsetHeight;
                    const cw = container.offsetWidth, ch = container.offsetHeight;

                    const move = (ev) => {
                        const curr = getXY(ev);
                        box.style.width = ((sw + (curr.x - start.x))/cw*100) + '%';
                        box.style.height = ((sh + (curr.y - start.y))/ch*100) + '%';
                    };
                    const end = () => { 
                        document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', end);
                        document.removeEventListener('touchmove', move); document.removeEventListener('touchend', end);
                    };
                    
                    document.addEventListener('mousemove', move); document.addEventListener('mouseup', end);
                    document.addEventListener('touchmove', move, {passive:false}); document.addEventListener('touchend', end);
                };

                // Drag Logic
                const startDrag = (e) => {
                    if(!isEditMode || e.target.classList.contains('resizer')) return;
                    if(e.type==='touchstart') e.preventDefault();
                    const start = getXY(e);
                    const rect = box.getBoundingClientRect();
                    const crect = container.getBoundingClientRect();
                    const sl = rect.left - crect.left, st = rect.top - crect.top;

                    const move = (ev) => {
                        if(ev.type==='touchmove') ev.preventDefault();
                        const curr = getXY(ev);
                        box.style.left = ((sl + (curr.x - start.x))/container.offsetWidth*100) + '%';
                        box.style.top = ((st + (curr.y - start.y))/container.offsetHeight*100) + '%';
                    };
                    const end = () => { 
                        document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', end);
                        document.removeEventListener('touchmove', move); document.removeEventListener('touchend', end);
                    };

                    document.addEventListener('mousemove', move); document.addEventListener('mouseup', end);
                    document.addEventListener('touchmove', move, {passive:false}); document.addEventListener('touchend', end);
                };

                if(resizer) {
                    resizer.addEventListener('mousedown', startResize);
                    resizer.addEventListener('touchstart', startResize, {passive:false});
                }
                box.addEventListener('mousedown', startDrag);
                box.addEventListener('touchstart', startDrag, {passive:false});
            });
        }

        // --- SAVE & RESET ---
        function savePositions() {
            const pos = {};
            document.querySelectorAll('.click-area, .scroll-area').forEach(b => {
                if(b.id) pos[b.id] = {t:b.style.top, l:b.style.left, w:b.style.width, h:b.style.height};
            });
            localStorage.setItem('simulasi_pos_final_fix_v4', JSON.stringify(pos));
        }

        function resetPositions() {
            if(confirm("Reset semua posisi ke default?")) {
                localStorage.removeItem('simulasi_pos_final_fix_v4');
                location.reload();
            }
        }
    </script>
</body>
</html>



<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Editor Simulasi Trading Fix</title>
    <style>
        /* --- RESET & LAYOUT --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: none; user-select: none; }
        
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: #000;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* --- WADAH APLIKASI --- */
        #app-viewport {
            position: relative;
            width: 100vw; 
            height: 100vh;
            height: 100dvh; /* Fullscreen modern */
            background: #000;
            overflow: hidden;
            z-index: 1;
        }

        /* --- LAYAR GAMBAR --- */
        .screen {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: none;
            background-size: 100% 100%; 
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }
        .screen.active { display: block; }

        /* --- SCROLL WRAPPER (STEP 8) --- */
        .scroll-wrapper {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow-y: scroll; -webkit-overflow-scrolling: touch; z-index: 2;
            scrollbar-width: none;
        }
        .scroll-wrapper::-webkit-scrollbar { display: none; }
        .scroll-wrapper img { width: 100%; display: block; height: auto; }

        /* --- AREA KLIK --- */
        .click-area, .scroll-area {
            position: absolute; z-index: 10; cursor: pointer;
        }

        /* --- TAMPILAN MODE EDIT (JELAS) --- */
        body.edit-mode .click-area {
            border: 2px dashed #FFD700; background: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 5px rgba(0,0,0,0.5); cursor: move;
        }
        body.edit-mode .scroll-area {
            border: 2px dashed #00FFFF; background: rgba(0, 255, 255, 0.3); cursor: move;
        }
        body.edit-mode .scroll-area::after {
            content: "AREA SWIPE"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: black; background: #00FFFF; font-size: 10px; padding: 2px 4px; font-weight: bold;
        }

        /* RESIZER (Hanya Edit Mode) */
        .resizer {
            width: 40px; height: 40px;
            background: #007bff; border: 2px solid white; border-radius: 50%;
            position: absolute; right: -15px; bottom: -15px;
            z-index: 20; display: none; box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        body.edit-mode .resizer { display: block; }

        /* --- TAMPILAN MODE PLAY (BERSIH) --- */
        body.play-mode .click-area, body.play-mode .scroll-area {
            border: none; background: transparent; cursor: pointer;
        }
        body.play-mode .click-area:active { background: rgba(255,255,255,0.1); }

        /* HINT MODE */
        body.show-hint .click-area {
            border: 3px solid #ff3b30; background: rgba(255, 59, 48, 0.2);
            animation: pulse 1s infinite alternate;
        }
        body.show-hint .scroll-area { border: 3px dashed #00BFFF; }
        @keyframes pulse { from { opacity: 0.5; } to { opacity: 1; } }

        /* --- UI EDITOR (YANG INI SELALU MUNCUL SAAT EDIT) --- */
        #editor-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(10, 10, 10, 0.95);
            border-top: 1px solid #333;
            padding: 10px;
            display: flex; flex-direction: column; gap: 10px;
            z-index: 99999; /* Paling Atas */
            transition: transform 0.3s;
        }
        
        body.play-mode #editor-bar { display: none !important; }

        /* Baris Tombol Atas (Navigasi Layar) */
        .nav-row {
            display: flex; justify-content: space-between; align-items: center;
            background: #222; padding: 5px 10px; border-radius: 8px;
        }
        .nav-label { color: white; font-size: 14px; font-weight: bold; }

        /* Baris Tombol Bawah (Aksi) */
        .action-row {
            display: flex; justify-content: center; gap: 8px;
        }

        button {
            padding: 10px 15px; border-radius: 8px; border: none;
            font-weight: bold; color: white; cursor: pointer; font-size: 13px;
        }
        .btn-nav { background: #444; font-size: 18px; width: 45px; }
        .btn-save { background: #28a745; flex-grow: 1; }
        .btn-reset { background: #dc3545; }
        .btn-move-ui { background: #007bff; width: 45px; font-size: 18px; }

        /* Class untuk pindah bar ke atas */
        #editor-bar.pos-top { bottom: auto; top: 0; border-top: none; border-bottom: 1px solid #333; }

        /* --- TOMBOL GERIGI (Hanya di Play Mode) --- */
        #gear-btn {
            position: absolute; top: 20px; left: 20px;
            width: 50px; height: 50px; z-index: 5000;
            background: rgba(255,255,255,0.1); border-radius: 50%;
            cursor: pointer; display: none;
            justify-content: center; align-items: center; font-size: 24px; color: white;
        }
        body.play-mode #gear-btn { display: flex; }

        /* --- FINISH SCREEN --- */
        #finish-screen {
            background: #000; color: white; display: none;
            flex-direction: column; justify-content: center; align-items: center;
            width: 100%; height: 100%; z-index: 100;
        }
    </style>
</head>
<body class="edit-mode"> <!-- Mulai mode edit -->

    <!-- Tombol Hint -->
    <div id="gear-btn" onclick="toggleHint()">‚öôÔ∏è</div>

    <!-- PANEL EDITOR (Akan hilang kalau dikunci) -->
    <div id="editor-bar">
        <!-- Baris 1: Pindah Layar Gambar -->
        <div class="nav-row">
            <button class="btn-nav" onclick="changeScreen(-1)">&#8249;</button>
            <span class="nav-label" id="screen-label">Layar 1 / 12</span>
            <button class="btn-nav" onclick="changeScreen(1)">&#8250;</button>
        </div>
        <!-- Baris 2: Aksi -->
        <div class="action-row">
            <button class="btn-move-ui" onclick="moveUI()">‚Üï</button>
            <button class="btn-reset" onclick="resetPos()">‚ö†Ô∏è Reset</button>
            <button class="btn-save" onclick="lockApp()">üîí SELESAI & KUNCI</button>
        </div>
    </div>

    <!-- WADAH UTAMA -->
    <div id="app-viewport">
        
        <!-- STEP 1 -->
        <div class="screen active" id="screen-1" style="background-image: url('1.jpg');">
            <div id="box-1" class="click-area" style="top: 73%; left: 26%; width: 18%; height: 9%;" onclick="go(2)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 2 -->
        <div class="screen" id="screen-2" style="background-image: url('2.jpg');">
            <div id="box-2" class="click-area" style="top: 17%; left: 0%; width: 100%; height: 10%;" onclick="go(3)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 3 -->
        <div class="screen" id="screen-3" style="background-image: url('3.jpg');">
            <div id="box-3" class="click-area" style="top: 0%; left: 30%; width: 70%; height: 8%;" onclick="go(4)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 4 -->
        <div class="screen" id="screen-4" style="background-image: url('4.jpg');">
            <div id="box-4" class="click-area" style="top: 50%; left: 5%; width: 90%; height: 25%;" onclick="go(5)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 5 -->
        <div class="screen" id="screen-5" style="background-image: url('5.jpg');">
            <div id="box-5" class="click-area" style="top: 0%; left: 0%; width: 15%; height: 8%;" onclick="go(6)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 6 -->
        <div class="screen" id="screen-6" style="background-image: url('6.jpg');">
            <div id="box-6" class="click-area" style="top: 60%; left: 26%; width: 18%; height: 9%;" onclick="go(7)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 7 -->
        <div class="screen" id="screen-7" style="background-image: url('7.jpg');">
            <div id="box-7" class="click-area" style="bottom: 0%; left: 25%; width: 25%; height: 8%;" onclick="go(8)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 8 (SCROLL) -->
        <div class="screen" id="screen-8">
            <div class="scroll-wrapper"><img src="8.jpg" ondragstart="return false;"></div>
            <div id="box-8" class="scroll-area" style="top: 30%; left: 10%; width: 80%; height: 40%;"><div class="resizer"></div></div>
        </div>

        <!-- STEP 9 -->
        <div class="screen" id="screen-9" style="background-image: url('9.jpg');">
            <div id="box-9" class="click-area" style="top: 35%; right: 5%; width: 40%; height: 6%;" onclick="go(10)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 10 (2 TAHAP) -->
        <div class="screen" id="screen-10" style="background-image: url('10.jpg');">
            <div id="box-10a" class="click-area" style="top: 45%; left: 5%; width: 15%; height: 5%;" onclick="step10Part2()"><div class="resizer"></div></div>
            <div id="box-10b" class="click-area" style="display:none; top: 55%; left: 5%; width: 43%; height: 7%;" onclick="go(11)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 11 -->
        <div class="screen" id="screen-11" style="background-image: url('11.jpg');">
            <div id="box-11" class="click-area" style="top: 55%; right: 10%; width: 35%; height: 6%;" onclick="go(12)"><div class="resizer"></div></div>
        </div>

        <!-- STEP 12 -->
        <div class="screen" id="screen-12" style="background-image: url('12.jpg');">
            <div id="box-12" class="click-area" style="bottom: 10%; left: 25%; width: 50%; height: 8%;" onclick="finish()"><div class="resizer"></div></div>
        </div>

        <!-- FINISH -->
        <div id="finish-screen">
            <h1 style="color: #28a745;">SUKSES!</h1>
            <button onclick="location.reload()" style="padding: 10px 30px; margin-top: 20px;">Ulangi</button>
        </div>

    </div>

    <script>
        const container = document.getElementById('app-viewport');
        const ui = document.getElementById('editor-bar');
        const label = document.getElementById('screen-label');
        let isEdit = true;
        let currentStep = 1;
        const totalSteps = 12;

        window.onload = function() {
            let saved = localStorage.getItem('simulasi_pos_final_edit');
            if (saved) {
                try {
                    const pos = JSON.parse(saved);
                    for(let id in pos) {
                        const el = document.getElementById(id);
                        if(el) {
                            el.style.top = pos[id].t;
                            el.style.left = pos[id].l;
                            el.style.width = pos[id].w;
                            el.style.height = pos[id].h;
                        }
                    }
                } catch(e) {}
            }
            initEditLogic();
            initScrollLogic();
        };

        // --- NAVIGASI EDITOR (Pindah Layar Manual) ---
        function changeScreen(direction) {
            let nextStep = currentStep + direction;
            if (nextStep < 1) nextStep = 1;
            if (nextStep > totalSteps) nextStep = totalSteps;
            
            currentStep = nextStep;
            label.innerText = `Layar ${currentStep} / ${totalSteps}`;
            
            // Tampilkan layar
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const target = document.getElementById('screen-' + currentStep);
            if(target) target.classList.add('active');

            // Khusus Step 10 saat edit, munculkan semua part
            if(currentStep === 10 && isEdit) {
                document.getElementById('box-10a').style.display = 'block';
                document.getElementById('box-10b').style.display = 'block';
            }
        }

        // --- FUNGSI KUNCI (LOCK) ---
        function lockApp() {
            if(confirm("Yakin posisi sudah pas? Tombol edit akan hilang.")) {
                savePos();
                isEdit = false;
                document.body.classList.remove('edit-mode');
                document.body.classList.add('play-mode');
                
                // Masuk Full Screen
                const de = document.documentElement;
                if(de.requestFullscreen) de.requestFullscreen().catch(()=>{});
                else if(de.webkitRequestFullscreen) de.webkitRequestFullscreen();

                // Reset ke Layar 1 untuk mulai main
                currentStep = 1;
                changeScreen(0); // Refresh view
                
                // Reset state Step 10
                document.getElementById('box-10a').style.display = 'block';
                document.getElementById('box-10b').style.display = 'none';
            }
        }

        function moveUI() { ui.classList.toggle('pos-top'); }
        function toggleHint() { if(!isEdit) document.body.classList.toggle('show-hint'); }

        // --- GAMEPLAY NAV ---
        function go(step) {
            if(isEdit) return; // Mode edit gak bisa klik pindah, pakai panah bawah
            currentStep = step;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-'+step).classList.add('active');
        }

        function step10Part2() {
            if(isEdit) return;
            document.getElementById('box-10a').style.display = 'none';
            document.getElementById('box-10b').style.display = 'block';
        }

        function finish() {
            if(isEdit) return;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('finish-screen').style.display = 'flex';
        }

        // --- LOGIKA SCROLL ---
        function initScrollLogic() {
            const box = document.getElementById('box-8');
            let sy = 0;
            box.addEventListener('touchstart', e => sy = e.touches[0].clientY, {passive:true});
            box.addEventListener('touchend', e => {
                if(!isEdit && (sy - e.changedTouches[0].clientY > 40)) go(9);
            }, {passive:true});
            box.addEventListener('mousedown', e => {
                sy = e.clientY;
                const up = mu => { 
                    if(!isEdit && (sy - mu.clientY > 40)) go(9); 
                    document.removeEventListener('mouseup', up);
                };
                document.addEventListener('mouseup', up);
            });
        }

        // --- EDIT LOGIC ---
        function initEditLogic() {
            const getXY = (e) => (e.touches && e.touches[0]) ? {x:e.touches[0].clientX, y:e.touches[0].clientY} : {x:e.clientX, y:e.clientY};
            
            const boxes = document.querySelectorAll('.click-area, .scroll-area');
            boxes.forEach(box => {
                const resizer = box.querySelector('.resizer');

                const startResize = (e) => {
                    if(!isEdit) return; e.stopPropagation();
                    const start = getXY(e);
                    const sw = box.offsetWidth, sh = box.offsetHeight;
                    const cw = container.offsetWidth, ch = container.offsetHeight;
                    const move = (ev) => {
                        const curr = getXY(ev);
                        box.style.width = ((sw + (curr.x - start.x))/cw*100) + '%';
                        box.style.height = ((sh + (curr.y - start.y))/ch*100) + '%';
                    };
                    const end = () => { unbind(move, end); };
                    bind(move, end);
                };

                const startDrag = (e) => {
                    if(!isEdit || e.target.classList.contains('resizer')) return;
                    if(e.type === 'touchstart') e.preventDefault();
                    const start = getXY(e);
                    const rect = box.getBoundingClientRect();
                    const sl = rect.left, st = rect.top; 
                    const move = (ev) => {
                        if(ev.type === 'touchmove') ev.preventDefault();
                        const curr = getXY(ev);
                        box.style.left = ((sl + (curr.x - start.x)) / container.offsetWidth * 100) + '%';
                        box.style.top = ((st + (curr.y - start.y)) / container.offsetHeight * 100) + '%';
                    };
                    const end = () => { unbind(move, end); };
                    bind(move, end);
                };

                if(resizer) {
                    resizer.addEventListener('mousedown', startResize);
                    resizer.addEventListener('touchstart', startResize, {passive:false});
                }
                box.addEventListener('mousedown', startDrag);
                box.addEventListener('touchstart', startDrag, {passive:false});
            });
        }

        function bind(mv, end) {
            document.addEventListener('mousemove', mv); document.addEventListener('mouseup', end);
            document.addEventListener('touchmove', mv, {passive:false}); document.addEventListener('touchend', end);
        }
        function unbind(mv, end) {
            document.removeEventListener('mousemove', mv); document.removeEventListener('mouseup', end);
            document.removeEventListener('touchmove', mv); document.removeEventListener('touchend', end);
        }

        function savePos() {
            const pos = {};
            document.querySelectorAll('.click-area, .scroll-area').forEach(b => {
                if(b.id) pos[b.id] = {t:b.style.top, l:b.style.left, w:b.style.width, h:b.style.height};
            });
            localStorage.setItem('simulasi_pos_final_edit', JSON.stringify(pos));
        }

        function resetPos() {
            if(confirm("Reset semua posisi?")) {
                localStorage.removeItem('simulasi_pos_final_edit');
                location.reload();
            }
        }
    </script>
</body>
</html>


